"use strict";var css=require("css"),CleanCSS=require("clean-css"),matchMedia=require("./matchMedia");module.exports=function(e){var s=e.cssFile,t=e.mediaOptions,a={},i=css.parse(s).stylesheet.rules,r={common:[],desktop:[],mobile:[],tabletPortrait:[],tabletLandscape:[],tablet:[]};return i.forEach(function(e,s){var a=e.type,o=e.media,n=matchMedia({mediaQuery:o,mediaOptions:t}),c=n.isDesktop,l=n.isTablet,u=n.isTabletLandscape,p=n.isTabletPortrait,m=n.isMobile,h=i[s],d=!c&&!l&&!m;"media"===a?(c&&r.desktop.push(h),u&&(r.tablet.push(h),r.tabletLandscape.push(h)),p&&(r.tablet.push(h),r.tabletPortrait.push(h)),m&&r.mobile.push(h),d&&r.common.push(h)):r.common.push(h)}),Object.keys(r).forEach(function(e){a[e]=[],r[e].forEach(function(s,t){var i=s.media,r=s.rules,o=(s.position,a[e].map(function(e){return e.media}).indexOf(i));!i||o<0?a[e].push(s):a[e][o].rules=a[e][o].rules.concat(r)});var s=css.stringify({type:"stylesheet",stylesheet:{rules:a[e]}});a[e]=(new CleanCSS).minify(s).styles}),a};