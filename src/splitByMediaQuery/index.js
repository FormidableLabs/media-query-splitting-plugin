"use strict";var css=require("css"),CleanCSS=require("clean-css"),matchMedia=require("./matchMedia");module.exports=function(a){var b=a.cssFile,c=a.mediaOptions,d={},e=css.parse(b).stylesheet.rules,f={common:[],desktop:[],mobile:[],tabletPortrait:[],tabletLandscape:[],tablet:[]};return e.forEach(function(a,b){var d=a.type,g=a.media,h=matchMedia({mediaQuery:g,mediaOptions:c}),i=h.isDesktop,j=h.isTablet,k=h.isTabletLandscape,l=h.isTabletPortrait,m=h.isMobile,n=e[b];"media"===d?(i&&f.desktop.push(n),k&&(f.tablet.push(n),f.tabletLandscape.push(n)),l&&(f.tablet.push(n),f.tabletPortrait.push(n)),m&&f.mobile.push(n),!i&&!j&&!m&&f.common.push(n)):f.common.push(n)}),Object.keys(f).forEach(function(a){d[a]=[];var b=f[a];b.forEach(function(b){var c=b.media,e=b.rules,f=b.position,g=d[a].map(function(a){var b=a.media;return b}).indexOf(c);!c||0>g?d[a].push(b):d[a][g].rules=d[a][g].rules.concat(e)});var c=css.stringify({type:"stylesheet",stylesheet:{rules:d[a]}});d[a]=new CleanCSS().minify(c).styles}),d};